<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - SkillSwap</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="top-bar-left">
            <button class="top-bar-btn">Copy</button>
            <button class="top-bar-btn">Publish</button>
        </div>
        <div class="top-bar-right">
            <div class="notification-bell">
                üîî
                <span class="notification-badge">3</span>
            </div>
            <div class="user-avatar-dropdown">
                <div class="avatar-circle"></div>
                <span>‚ñº</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üéì</span>
                <span class="logo-text">SkillSwap</span>
            </div>
            <nav class="main-nav">
                <a href="/discover.html">Discover</a>
                <a href="/matches.html">Matches</a>
                <a href="/messages.html">Messages</a>
                <a href="/profile.html" class="active">Profile</a>
                <a href="/login.html" id="login-link" style="display: none;">Login</a>
                <a href="#" id="logout-link" style="display: none;">Logout</a>
            </nav>
        </div>
    </header>

    <!-- Main Content - Full Width -->
    <main style="padding: 2rem; max-width: 1400px; margin: 0 auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="margin: 0; font-size: 2rem;">My Profile</h1>
            <button class="btn btn-primary" onclick="window.location.href='/view-profile.html'">
                üëÅÔ∏è View My Profile
            </button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <!-- Left Column -->
            <div>
                <!-- Basic Information -->
                <div class="profile-section-card">
                    <h3>Basic Information</h3>
                    <form id="profile-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input type="text" id="firstName" name="firstName" placeholder="Enter your first name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName" name="lastName" placeholder="Enter your last name" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="bio">Bio</label>
                            <textarea id="bio" name="bio" rows="4" placeholder="Tell us about yourself, your interests, and what you're looking for..."></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label for="major">Major</label>
                                <input type="text" id="major" name="major" placeholder="e.g., Computer Science">
                            </div>
                            
                            <div class="form-group">
                                <label for="year">Year</label>
                                <select id="year" name="year">
                                    <option value="">Select Year</option>
                                    <option value="Freshman">Freshman</option>
                                    <option value="Sophomore">Sophomore</option>
                                    <option value="Junior">Junior</option>
                                    <option value="Senior">Senior</option>
                                    <option value="Graduate">Graduate</option>
                                    <option value="Faculty">Faculty</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="location">Location</label>
                            <input type="text" id="location" name="location" placeholder="e.g., Atlanta, GA">
                        </div>

                        <div class="form-group">
                            <label for="career-goals">Career Goals</label>
                            <textarea id="career-goals" name="career-goals" rows="3" placeholder="What are your career aspirations?"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="availability">Availability</label>
                            <select id="availability" name="availability">
                                <option value="">Select Availability</option>
                                <option value="Very Available">Very Available (10+ hours/week)</option>
                                <option value="Moderately Available">Moderately Available (5-10 hours/week)</option>
                                <option value="Limited Availability">Limited Availability (1-5 hours/week)</option>
                                <option value="On Demand">On Demand (As needed)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="career">Career/Job Title</label>
                            <input type="text" id="career" name="career" placeholder="e.g., Software Engineer, Research Assistant, etc.">
                        </div>

                        <div class="form-group">
                            <label for="career-experience">Career Experience</label>
                            <textarea id="career-experience" name="career-experience" rows="4" placeholder="Describe your work experience, internships, projects, etc."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="research-publications">Research & Publications</label>
                            <textarea id="research-publications" name="research-publications" rows="4" placeholder="List your research projects, publications, papers, etc."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="awards">Awards & Achievements</label>
                            <textarea id="awards" name="awards" rows="4" placeholder="List any awards, honors, certifications, etc."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Save Profile</button>
                        <div id="profile-message" style="margin-top: 1rem;"></div>
                    </form>
                </div>

                <!-- Languages -->
                <div class="profile-section-card">
                    <h3>Languages</h3>
                    <div id="languages-list"></div>
                    <button class="btn btn-secondary" onclick="showAddLanguageForm()" style="margin-top: 1rem; width: 100%;">Add Language</button>
                    <div id="add-language-form" style="display: none; margin-top: 1rem;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 0.5rem;">
                            <select id="new-language-name" style="padding: 0.5rem;">
                                <option value="">Select Language</option>
                                <option value="English">English</option>
                                <option value="Spanish">Spanish</option>
                                <option value="French">French</option>
                                <option value="German">German</option>
                                <option value="Chinese">Chinese</option>
                                <option value="Japanese">Japanese</option>
                                <option value="Korean">Korean</option>
                                <option value="Arabic">Arabic</option>
                                <option value="Portuguese">Portuguese</option>
                                <option value="Italian">Italian</option>
                            </select>
                            <select id="new-language-level" style="padding: 0.5rem;">
                                <option value="Native">Native</option>
                                <option value="Fluent">Fluent</option>
                                <option value="Conversational">Conversational</option>
                                <option value="Basic">Basic</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button class="btn btn-primary" onclick="addLanguage()" style="flex: 1;">Add</button>
                            <button class="btn btn-secondary" onclick="hideAddLanguageForm()" style="flex: 1;">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Skills -->
                <div class="profile-section-card">
                    <h3>My Skills</h3>
                    <div id="skills-list"></div>
                    <button class="btn btn-secondary" onclick="showAddSkillForm()" style="margin-top: 1rem; width: 100%;">Add Skill</button>
                    <div id="add-skill-form" style="display: none; margin-top: 1rem;">
                        <input type="text" id="new-skill-name" placeholder="Skill name" style="padding: 0.5rem; width: 100%; margin-bottom: 0.5rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <select id="new-skill-level" style="padding: 0.5rem;">
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advanced">Advanced</option>
                                <option value="Expert">Expert</option>
                            </select>
                            <select id="new-skill-category" style="padding: 0.5rem;">
                                <option value="">Category (optional)</option>
                                <option value="Technical">Technical</option>
                                <option value="Creative">Creative</option>
                                <option value="Business">Business</option>
                                <option value="Language">Language</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-bottom: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="offering"> Offering
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="seeking"> Seeking
                            </label>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="addSkill()" style="flex: 1;">Add</button>
                            <button class="btn btn-secondary" onclick="hideAddSkillForm()" style="flex: 1;">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Interests -->
                <div class="profile-section-card">
                    <h3>Interests & Hobbies</h3>
                    <div id="interests-list"></div>
                    <button class="btn btn-secondary" onclick="showAddInterestForm()" style="margin-top: 1rem; width: 100%;">Add Interest</button>
                    <div id="add-interest-form" style="display: none; margin-top: 1rem;">
                        <input type="text" id="new-interest-name" placeholder="Interest name" style="padding: 0.5rem; width: 100%; margin-bottom: 0.5rem;">
                        <select id="new-interest-category" style="padding: 0.5rem; width: 100%; margin-bottom: 0.5rem;">
                            <option value="">Category (optional)</option>
                            <option value="Technology">Technology</option>
                            <option value="Arts">Arts</option>
                            <option value="Sports">Sports</option>
                            <option value="Music">Music</option>
                            <option value="Travel">Travel</option>
                            <option value="Food">Food</option>
                            <option value="Gaming">Gaming</option>
                            <option value="Reading">Reading</option>
                            <option value="Other">Other</option>
                        </select>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="addInterest()" style="flex: 1;">Add</button>
                            <button class="btn btn-secondary" onclick="hideAddInterestForm()" style="flex: 1;">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Organizations -->
                <div class="profile-section-card">
                    <h3>Organizations & Clubs</h3>
                    <div id="organizations-list"></div>
                    <button class="btn btn-secondary" onclick="showAddOrgForm()" style="margin-top: 1rem; width: 100%;">Add Organization</button>
                    <div id="add-org-form" style="display: none; margin-top: 1rem;">
                        <input type="text" id="new-org-name" placeholder="Organization name" style="padding: 0.5rem; width: 100%; margin-bottom: 0.5rem;">
                        <input type="text" id="new-org-role" placeholder="Your role (e.g., President, Member)" style="padding: 0.5rem; width: 100%; margin-bottom: 0.5rem;">
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="addOrganization()" style="flex: 1;">Add</button>
                            <button class="btn btn-secondary" onclick="hideAddOrgForm()" style="flex: 1;">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Social Links -->
                <div class="profile-section-card">
                    <h3>Social Links (Optional)</h3>
                    <div class="form-group">
                        <label for="linkedin">LinkedIn</label>
                        <input type="url" id="linkedin" name="linkedin" placeholder="https://linkedin.com/in/yourprofile">
                    </div>
                    <div class="form-group">
                        <label for="github">GitHub</label>
                        <input type="url" id="github" name="github" placeholder="https://github.com/yourusername">
                    </div>
                    <div class="form-group">
                        <label for="portfolio">Portfolio Website</label>
                        <input type="url" id="portfolio" name="portfolio" placeholder="https://yourportfolio.com">
                    </div>
                    <button class="btn btn-secondary" onclick="saveSocialLinks()" style="width: 100%;">Save Links</button>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script>
        let currentUserId = getCurrentUserId();
        let currentProfile = null;

        async function loadProfile() {
            try {
                const [users, profiles, userSkills, userInterests, userOrgs, userLanguages] = await Promise.all([
                    fetch('/api/users').then(r => r.json()),
                    fetch('/api/profiles').then(r => r.json()),
                    fetch('/api/user-skills').then(r => r.json()).catch(() => []),
                    fetch('/api/interests').then(r => r.json()).catch(() => []),
                    fetch('/api/organizations').then(r => r.json()).catch(() => []),
                    fetch('/api/languages').then(r => r.json()).catch(() => [])
                ]);

                const currentUser = users.find(u => u.userId === currentUserId);
                currentProfile = profiles.find(p => p.user?.userId === currentUserId);
                
                // Load user name
                if (currentUser) {
                    document.getElementById('firstName').value = currentUser.firstName || '';
                    document.getElementById('lastName').value = currentUser.lastName || '';
                }
                
                // Load profile data
                if (currentProfile) {
                    document.getElementById('bio').value = currentProfile.bio || '';
                    document.getElementById('major').value = currentProfile.major || '';
                    document.getElementById('year').value = currentProfile.year || '';
                    document.getElementById('location').value = currentProfile.location || '';
                    document.getElementById('career-goals').value = currentProfile.careerGoals || '';
                    document.getElementById('availability').value = currentProfile.availability || '';
                    document.getElementById('linkedin').value = currentProfile.linkedin || '';
                    document.getElementById('github').value = currentProfile.github || '';
                    document.getElementById('portfolio').value = currentProfile.portfolio || '';
                    document.getElementById('career').value = currentProfile.career || '';
                    document.getElementById('career-experience').value = currentProfile.careerExperience || '';
                    document.getElementById('research-publications').value = currentProfile.researchPublications || '';
                    document.getElementById('awards').value = currentProfile.awards || '';
                }

                // Load languages, skills, interests, organizations
                displayLanguages(userLanguages.filter(l => l.user?.userId === currentUserId));
                displaySkills(userSkills.filter(s => s.user?.userId === currentUserId));
                displayInterests(userInterests.filter(i => i.user?.userId === currentUserId));
                displayOrganizations(userOrgs.filter(o => o.user?.userId === currentUserId));
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        function displaySkills(skills) {
            const container = document.getElementById('skills-list');
            if (skills.length === 0) {
                container.innerHTML = '<p style="color: #666;">No skills added yet.</p>';
                return;
            }
            container.innerHTML = skills.map(skill => `
                <div style="padding: 0.75rem; background: #f5f5f5; border-radius: 5px; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>${skill.skillName}</strong> - ${skill.skillLevel || 'Not specified'}
                        ${skill.offering ? '<span style="color: #28a745; margin-left: 0.5rem;">[Offering]</span>' : ''}
                        ${skill.seeking ? '<span style="color: #667eea; margin-left: 0.5rem;">[Seeking]</span>' : ''}
                    </div>
                    <button onclick="deleteSkill(${skill.skillId})" style="background: #dc3545; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; cursor: pointer;">Delete</button>
                </div>
            `).join('');
        }

        function displayInterests(interests) {
            const container = document.getElementById('interests-list');
            if (interests.length === 0) {
                container.innerHTML = '<p style="color: #666;">No interests added yet.</p>';
                return;
            }
            container.innerHTML = interests.map(interest => `
                <div style="padding: 0.75rem; background: #f5f5f5; border-radius: 5px; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                    <div><strong>${interest.interestName}</strong>${interest.category ? ' - ' + interest.category : ''}</div>
                    <button onclick="deleteInterest(${interest.interestId})" style="background: #dc3545; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; cursor: pointer;">Delete</button>
                </div>
            `).join('');
        }

        function displayOrganizations(orgs) {
            const container = document.getElementById('organizations-list');
            if (orgs.length === 0) {
                container.innerHTML = '<p style="color: #666;">No organizations added yet.</p>';
                return;
            }
            container.innerHTML = orgs.map(org => `
                <div style="padding: 0.75rem; background: #f5f5f5; border-radius: 5px; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                    <div><strong>${org.organizationName}</strong>${org.role ? ' - ' + org.role : ''}</div>
                    <button onclick="deleteOrganization(${org.orgId})" style="background: #dc3545; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; cursor: pointer;">Delete</button>
                </div>
            `).join('');
        }

        document.getElementById('profile-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Check if user is logged in
            if (!currentUserId || currentUserId === 1) {
                const currentUser = checkAuth();
                if (!currentUser) {
                    document.getElementById('profile-message').innerHTML = 
                        '<div class="error-message">Please log in to save your profile. <a href="/login.html">Login here</a></div>';
                    return;
                }
                currentUserId = currentUser.userId || currentUser.id;
            }
            
            let user;
            try {
                // Try to get user directly by ID first
                try {
                    const userResponse = await fetch(`/api/users/${currentUserId}`);
                    if (userResponse.ok) {
                        user = await userResponse.json();
                    } else {
                        // Fallback to getting all users
                        const usersResponse = await fetch('/api/users');
                        const users = await usersResponse.json();
                        user = users.find(u => u.userId === currentUserId);
                    }
                } catch (err) {
                    // Fallback to getting all users
                    const usersResponse = await fetch('/api/users');
                    const users = await usersResponse.json();
                    user = users.find(u => u.userId === currentUserId);
                }
                
                if (!user) {
                    document.getElementById('profile-message').innerHTML = 
                        '<div class="error-message">User not found. Please log in again. <a href="/login.html">Login here</a></div>';
                    return;
                }
            } catch (error) {
                document.getElementById('profile-message').innerHTML = 
                    '<div class="error-message">Error loading user: ' + error.message + '</div>';
                return;
            }
            
            // Update user name first
            const userData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value
            };

            try {
                // Update user information
                const userResponse = await fetch(`/api/users/${currentUserId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });

                if (!userResponse.ok) {
                    throw new Error('Failed to update user information');
                }

                // Update localStorage with new user data
                const updatedUser = await userResponse.json();
                setCurrentUser(updatedUser);
                
                // Update the user object for profile data
                user = updatedUser;

                // Update profile data
                const profileData = {
                    user: user,
                    bio: document.getElementById('bio').value,
                    major: document.getElementById('major').value,
                    year: document.getElementById('year').value,
                    location: document.getElementById('location').value,
                    careerGoals: document.getElementById('career-goals').value,
                    availability: document.getElementById('availability').value,
                    linkedin: document.getElementById('linkedin').value,
                    github: document.getElementById('github').value,
                    portfolio: document.getElementById('portfolio').value,
                    career: document.getElementById('career').value,
                    careerExperience: document.getElementById('career-experience').value,
                    researchPublications: document.getElementById('research-publications').value,
                    awards: document.getElementById('awards').value
                };

                let response;
                if (currentProfile && currentProfile.profileId) {
                    response = await fetch(`/api/profiles/${currentProfile.profileId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(profileData)
                    });
                } else {
                    response = await fetch('/api/profiles', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(profileData)
                    });
                }

                if (response.ok) {
                    const savedProfile = await response.json();
                    currentProfile = savedProfile;
                    document.getElementById('profile-message').innerHTML = 
                        '<div class="success-message">Profile saved successfully!</div>';
                    setTimeout(() => {
                        document.getElementById('profile-message').innerHTML = '';
                    }, 3000);
                    loadProfile();
                } else {
                    const errorText = await response.text();
                    document.getElementById('profile-message').innerHTML = 
                        '<div class="error-message">Error saving profile: ' + errorText + '</div>';
                }
            } catch (error) {
                document.getElementById('profile-message').innerHTML = 
                    '<div class="error-message">Error: ' + error.message + '</div>';
            }
        });

        async function saveSocialLinks() {
            let user;
            try {
                const usersResponse = await fetch('/api/users');
                const users = await usersResponse.json();
                user = users.find(u => u.userId === currentUserId);
                
                if (!user) {
                    alert('User not found');
                    return;
                }
            } catch (error) {
                alert('Error loading user: ' + error.message);
                return;
            }
            
            const profileData = {
                user: user,
                linkedin: document.getElementById('linkedin').value,
                github: document.getElementById('github').value,
                portfolio: document.getElementById('portfolio').value
            };

            try {
                let response;
                if (currentProfile && currentProfile.profileId) {
                    // Merge with existing profile data
                    profileData.bio = currentProfile.bio || '';
                    profileData.major = currentProfile.major || '';
                    profileData.year = currentProfile.year || '';
                    profileData.location = currentProfile.location || '';
                    profileData.careerGoals = currentProfile.careerGoals || '';
                    profileData.availability = currentProfile.availability || '';
                    
                    response = await fetch(`/api/profiles/${currentProfile.profileId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(profileData)
                    });
                } else {
                    response = await fetch('/api/profiles', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(profileData)
                    });
                }

                if (response.ok) {
                    const savedProfile = await response.json();
                    currentProfile = savedProfile;
                    alert('Social links saved successfully!');
                    loadProfile();
                } else {
                    alert('Error saving social links');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function showAddSkillForm() {
            document.getElementById('add-skill-form').style.display = 'block';
        }

        function hideAddSkillForm() {
            document.getElementById('add-skill-form').style.display = 'none';
        }

        async function addSkill() {
            const skillData = {
                user: { userId: currentUserId },
                skillName: document.getElementById('new-skill-name').value,
                skillLevel: document.getElementById('new-skill-level').value,
                offering: document.getElementById('offering').checked,
                seeking: document.getElementById('seeking').checked
            };

            try {
                const response = await fetch('/api/user-skills', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(skillData)
                });

                if (response.ok) {
                    loadProfile();
                    hideAddSkillForm();
                    document.getElementById('new-skill-name').value = '';
                }
            } catch (error) {
                console.error('Error adding skill:', error);
            }
        }

        function showAddInterestForm() {
            document.getElementById('add-interest-form').style.display = 'block';
        }

        function hideAddInterestForm() {
            document.getElementById('add-interest-form').style.display = 'none';
        }

        async function addInterest() {
            const interestData = {
                user: { userId: currentUserId },
                interestName: document.getElementById('new-interest-name').value,
                category: document.getElementById('new-interest-category').value
            };

            try {
                const response = await fetch('/api/interests', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(interestData)
                });

                if (response.ok) {
                    loadProfile();
                    hideAddInterestForm();
                    document.getElementById('new-interest-name').value = '';
                    document.getElementById('new-interest-category').value = '';
                }
            } catch (error) {
                console.error('Error adding interest:', error);
            }
        }

        function showAddOrgForm() {
            document.getElementById('add-org-form').style.display = 'block';
        }

        function hideAddOrgForm() {
            document.getElementById('add-org-form').style.display = 'none';
        }

        async function addOrganization() {
            const orgData = {
                user: { userId: currentUserId },
                organizationName: document.getElementById('new-org-name').value,
                role: document.getElementById('new-org-role').value
            };

            try {
                const response = await fetch('/api/organizations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orgData)
                });

                if (response.ok) {
                    loadProfile();
                    hideAddOrgForm();
                    document.getElementById('new-org-name').value = '';
                    document.getElementById('new-org-role').value = '';
                }
            } catch (error) {
                console.error('Error adding organization:', error);
            }
        }

        function showAddLanguageForm() {
            document.getElementById('add-language-form').style.display = 'block';
        }

        function hideAddLanguageForm() {
            document.getElementById('add-language-form').style.display = 'none';
        }

        function displayLanguages(languages) {
            const container = document.getElementById('languages-list');
            if (languages.length === 0) {
                container.innerHTML = '<p style="color: #666;">No languages added yet.</p>';
                return;
            }
            container.innerHTML = languages.map(lang => `
                <div style="padding: 0.75rem; background: #f5f5f5; border-radius: 5px; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
                    <div><strong>${lang.languageName}</strong>${lang.proficiencyLevel ? ' - ' + lang.proficiencyLevel : ''}</div>
                    <button onclick="deleteLanguage(${lang.languageId})" style="background: #dc3545; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 3px; cursor: pointer;">Delete</button>
                </div>
            `).join('');
        }

        async function addLanguage() {
            const languageName = document.getElementById('new-language-name').value;
            const proficiencyLevel = document.getElementById('new-language-level').value;

            if (!languageName) {
                alert('Please select a language');
                return;
            }

            try {
                const languageData = {
                    user: { userId: currentUserId },
                    languageName: languageName,
                    proficiencyLevel: proficiencyLevel
                };

                const response = await fetch('/api/languages', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(languageData)
                });

                if (response.ok) {
                    document.getElementById('new-language-name').value = '';
                    document.getElementById('new-language-level').value = 'Native';
                    hideAddLanguageForm();
                    loadProfile();
                } else {
                    alert('Error adding language');
                }
            } catch (error) {
                console.error('Error adding language:', error);
                alert('Error adding language: ' + error.message);
            }
        }

        async function deleteLanguage(languageId) {
            if (confirm('Are you sure you want to delete this language?')) {
                try {
                    await fetch(`/api/languages/${languageId}`, { method: 'DELETE' });
                    loadProfile();
                } catch (error) {
                    console.error('Error deleting language:', error);
                }
            }
        }

        async function deleteSkill(skillId) {
            if (confirm('Delete this skill?')) {
                try {
                    await fetch(`/api/user-skills/${skillId}`, { method: 'DELETE' });
                    loadProfile();
                } catch (error) {
                    console.error('Error deleting skill:', error);
                }
            }
        }

        async function deleteInterest(interestId) {
            if (confirm('Delete this interest?')) {
                try {
                    await fetch(`/api/interests/${interestId}`, { method: 'DELETE' });
                    loadProfile();
                } catch (error) {
                    console.error('Error deleting interest:', error);
                }
            }
        }

        async function deleteOrganization(orgId) {
            if (confirm('Delete this organization?')) {
                try {
                    await fetch(`/api/organizations/${orgId}`, { method: 'DELETE' });
                    loadProfile();
                } catch (error) {
                    console.error('Error deleting organization:', error);
                }
            }
        }

        loadProfile();
    </script>
</body>
</html>
